let
    Source = Excel.Workbook(File.Contents("C:\Users\Hamza\Documents\DataAnalyst\Settimana9\M3S1E2.xlsx"), null, true),
    Ordini_Sheet = Source{[Item="Ordini",Kind="Sheet"]}[Data],
    #"Promoted Headers" = Table.PromoteHeaders(Ordini_Sheet, [PromoteAllScalars=true]),
    #"Changed Type" = Table.TransformColumnTypes(#"Promoted Headers",{{"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Removed Columns" = Table.RemoveColumns(#"Changed Type",{"Column3", "Column9"}),
    #"Removed Top Rows" = Table.Skip(#"Removed Columns",2),
    #"Promoted Headers1" = Table.PromoteHeaders(#"Removed Top Rows", [PromoteAllScalars=true]),
    #"Changed Type1" = Table.TransformColumnTypes(#"Promoted Headers1",{{"COD PROD", type text}, {"Column2", type any}, {"Collaboratore", type text}, {"Regione", type text}, {"Column5", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Removed Columns1" = Table.RemoveColumns(#"Changed Type1",{"Column2"}),
    #"Replaced Value" = Table.ReplaceValue(#"Removed Columns1",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Changed Type2" = Table.TransformColumnTypes(#"Replaced Value",{{"Prezzo unitario", Currency.Type}}),
    #"Capitalized Each Word" = Table.TransformColumns(#"Changed Type2",{{"Regione", Text.Proper, type text}}),
    #"Trimmed Text" = Table.TransformColumns(#"Capitalized Each Word",{{"Regione", Text.Trim, type text}}),
    #"Filtered Rows" = Table.SelectRows(#"Trimmed Text", each true),
    #"Trimmed Text1" = Table.TransformColumns(#"Filtered Rows",{{"Prodotto", Text.Trim, type text}}),
    #"Capitalized Each Word1" = Table.TransformColumns(#"Trimmed Text1",{{"Prodotto", Text.Proper, type text}}),
    #"Trimmed Text2" = Table.TransformColumns(#"Capitalized Each Word1",{{"Categoria", Text.Trim, type text}}),
    #"Capitalized Each Word2" = Table.TransformColumns(#"Trimmed Text2",{{"Categoria", Text.Proper, type text}}),
    #"Merged Columns" = Table.CombineColumns(#"Capitalized Each Word2",{"Categoria", "Prodotto"},Combiner.CombineTextByDelimiter(" ", QuoteStyle.None),"CATPROD"),
    #"Added Custom" = Table.AddColumn(#"Merged Columns", "SE", each if [Quantità] > 20 then "TROBVATO" else 0),
    #"Renamed Columns" = Table.RenameColumns(#"Added Custom",{{"Column5", "DATA ORDINE"}}),
    #"Reordered Columns" = Table.ReorderColumns(#"Renamed Columns",{"DATA ORDINE", "COD PROD", "Collaboratore", "Regione", "CATPROD", "Prezzo unitario", "Quantità", "SE"}),
    #"Added Custom1" = Table.AddColumn(#"Reordered Columns", "Totale", each [Prezzo unitario]*[Quantità]),
    #"Sorted Rows" = Table.Sort(#"Added Custom1",{{"Collaboratore", Order.Ascending}}),
    #"Trimmed Text3" = Table.TransformColumns(#"Sorted Rows",{{"Collaboratore", Text.Trim, type text}}),
    #"Added Custom2" = Table.AddColumn(#"Trimmed Text3", "CIFRE", each Text.Start([Regione], 4)),
    #"Replaced Value1" = Table.ReplaceValue(#"Added Custom2","Fove Anna","",Replacer.ReplaceText,{"Collaboratore"}),
    #"Removed Blank Rows" = Table.SelectRows(#"Replaced Value1", each not List.IsEmpty(List.RemoveMatchingItems(Record.FieldValues(_), {"", null}))),
    #"Filtered Rows1" = Table.SelectRows(#"Removed Blank Rows", each ([Collaboratore] <> "")),
    #"Added Custom3" = Table.AddColumn(#"Filtered Rows1", "IVA", each [Totale] * 0.22),
    #"Changed Type3" = Table.TransformColumnTypes(#"Added Custom3",{{"IVA", Currency.Type}}),
    #"Filtered Rows2" = Table.SelectRows(#"Changed Type3", each true),
    #"Cambiato il tipo in" = Table.TransformColumnTypes(#"Filtered Rows2",{{"Totale", Currency.Type}}),
    #"Regioni in Maiuscolo" = Table.TransformColumns(#"Cambiato il tipo in",{{"Regione", Text.Upper, type text}})
in
    #"Regioni in Maiuscolo"